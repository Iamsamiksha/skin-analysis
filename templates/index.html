<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Face Age Prediction</title>
  <style>
      body { font-family: Arial, sans-serif; text-align: center; }
      input[type="file"] { margin: 20px 0; }
      button { padding: 10px 20px; cursor: pointer; }
      img { width: 300px; height: auto; margin: 20px 0; }
  </style>
</head>
<body>
  <h1>Upload or Capture a Photo for Age Prediction</h1>

  <h3>Upload an Image</h3>
  <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="file" id="fileInput" accept="image/*">
      <button type="submit">Upload Image</button>
  </form>

  <h3>Capture from Webcam</h3>
  <video id="webcam" width="300" height="200" autoplay></video>
  <br>
  <button onclick="captureImage()">Capture Image</button>

  <h3>Prediction Result</h3>
  <div id="result"></div>
  <img id="uploadedImage" src="" alt="Uploaded or Captured Image">

  <script>
    const video = document.getElementById("webcam");
    const constraints = { video: { facingMode: "user" } };

    navigator.mediaDevices.getUserMedia(constraints)
        .then((stream) => { video.srcObject = stream; })
        .catch((error) => { alert("Error accessing webcam: " + error); });
  
    function captureImage() {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth || 640;
        canvas.height = video.videoHeight || 480;
        const context = canvas.getContext("2d");
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL("image/jpeg");
  
        document.getElementById('result').innerText = "Processing...";
        
        fetch('/upload_webcam', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image: imageData })
        })
        .then(response => response.json())
        .then(data => {
            if (data.age !== undefined) {
                document.getElementById('result').innerText = `Predicted Age: ${data.age}`;
            } else if (data.error) {
                document.getElementById('result').innerText = `Error: ${data.error}`;
            } else {
                document.getElementById('result').innerText = "No age prediction returned.";
            }
            document.getElementById('uploadedImage').src = imageData;
        })
        .catch(error => {
            console.log("Error:", error);
            document.getElementById('result').innerText = "Server error. Try again.";
        });
    }
  
    document.getElementById("uploadForm").addEventListener("submit", function(event) {
        event.preventDefault();
        const fileInput = document.getElementById("fileInput");
        if (fileInput.files.length === 0) {
            alert("Please select a file to upload.");
            return;
        }
  
        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        document.getElementById('result').innerText = "Processing...";
  
        fetch('/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.age !== undefined) {
                document.getElementById('result').innerText = `Predicted Age: ${data.age - 10}`;
            } else if (data.error) {
                document.getElementById('result').innerText = `Error: ${data.error}`;
            } else {
                document.getElementById('result').innerText = "No age prediction returned.";
            }
            document.getElementById('uploadedImage').src = URL.createObjectURL(fileInput.files[0]);
        })
        .catch(error => {
            console.log("Error:", error);
            document.getElementById('result').innerText = "Server error. Try again.";
        });
    });
  </script>
</body>
</html>
